---
title: "What Happen When Push Event On Bare"
categories:
  - Git
toc: true
toc_sticky: true
toc_label: "Contents"
published: false
---


### Overview
---
ν΄λΌμ΄μ–ΈνΈμ—μ„ `git push` λ…λ Ήμ΄ μ‹¤ν–‰λλ©΄, μ„λ²„μ—μ„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ „μ†΅λ μ»¤λ°‹ λ° κ°μ²΄λ¥Ό μμ‹ ν•κ³  **Bare Repository**λ¥Ό κ°±μ‹ ν•λ‹¤. 

μ„λ²„λ” **μ“°κΈ° μ¤‘μ‹¬μ λ™μ‘** μ„ μν–‰ν•λ©°, μ‹¤μ  Mergeλ‚ Rebase μ—†μ΄ λ‹¨μν μ°Έμ΅°(refs)μ™€ κ°μ²΄λ¥Ό κ°±μ‹ ν•λ‹¤.



### Key Terms Explained
---
- `Pack`: Git κ°μ²΄λ¥Ό ν¨μ¨μ μΌλ΅ μ €μ¥ν•κΈ°μ„ν• μ••μ¶• νμΌ ν•μ‹μΌλ΅, `.pack` νμΌκ³Ό μΈλ±μ¤μ—­ν• μ„ ν•λ”`.idx` νμΌλ΅ κµ¬μ„±λλ‹¤.
- `Bare Repository`: `.git` ν΄λ”λ§ μ΅΄μ¬ν•λ©°, μ‘μ—… λ””λ ‰ν„°λ¦¬(working tree)κ°€ μ—†λ” μ €μ¥μ† ν•νƒλ΅, μ„λ²„μ—μ„ μ›κ²© μ €μ¥μ†λ΅ μ‚¬μ©λλ‹¤.
- `git-upload-pack`: ν΄λΌμ΄μ–ΈνΈμ Push(νΉμ€ Fetch) μ”μ²­μ„ μ²λ¦¬ν•λ” μ½κΈ° μ „μ© μ—”λ“ν¬μΈνΈ
- `git-receive-pack`: ν΄λΌμ΄μ–ΈνΈμ Push μ”μ²­μ„ μ²λ¦¬ν•λ” μ“°κΈ° μ „μ© μ—”λ“ν¬μΈνΈ

- `oid`: 



### Flow 
---

Git ν΄λΌμ΄μ–ΈνΈκ°€ `git push` ν†µν•΄ μ„λ²„λ΅ μ”μ²­μ‹ μ„λ²„μ—μ„λ” `git-upload-pack` APIλ¥Ό ν†µν•΄ **Bare Repository**λ¥Ό κ°±μ‹ ν•λ‹¤. (μ”μ²­μ— μ‹ κ· μ»¤λ°‹, κ°μ²΄λ“¤ ν¬ν•¨)

<!-- TODO: μ¶©λ λ°μƒ  -->

```mermaid
sequenceDiagram
    autonumber
    participant C as Client (git push)
    participant G as Git Server (JGit GitServlet)
    participant R as Bare Repo (.git) (FS)

    Note over C: git push = send commits + update refs<br/>μ„λ²„λ” μ“°κΈ°(λ°μ) μ¤‘μ‹¬μ μ‘μ—… μν–‰

    C->>G: GET /<repo>.git/info/refs?service=git-receive-pack
    G->>R: refs μ΅°ν + capability ν™•μΈ
    R-->>G: refs λ©λ΅
    G-->>C: refs + capabilities (Discovery λ‹¨κ³„)

    C->>G: POST /<repo>.git/git-receive-pack<br/>(update refs, packfile μ „μ†΅)
    C-->>G: packfile λ°μ΄ν„° μ „μ†΅ (.pack + .idx)
    G->>R: packfile μμ‹  λ° κ°μ²΄ μ €μ¥ (objects/pack)
    G->>R: refs μ—…λ°μ΄νΈ (e.g., refs/heads/main)

    Note over G,R: pre/post-receive hook λ“± μ‹¤ν–‰ κ°€λ¥

    G-->>C: μμ‹  κ²°κ³Ό μ‘λ‹µ(success or reject)
    Note over C: push μ™„λ£ λ©”μ‹μ§€ μ¶λ ¥
```





### Flow Detail
---
#### 1. Discovery
λ¥΄λΌμ΄μ–ΈνΈκ°€ `git push` (Smart HTTPλ°©μ‹)μ„ μν–‰ν•λ©΄, λ‚΄λ¶€μ μΌλ΅ μ„λ²„μ `git-upload-pack` μ—”λ“ν¬μΈνΈλ΅ refs μ •λ³΄λ¥Ό μ”μ²­ν•λ‹¤.



##### 1-1. ν΄λΌμ΄μ–ΈνΈ μ”μ²­ 
``` bash
GET /<repo>.git/info/refs?service=git-upload-pack
```



##### 1-2 μ„λ²„ μ‘λ‹µ
μ„λ²„λ” Bare Repositoryμ λ‚΄λ¶€ μ •λ³΄λ¥Ό μ΅°νν•΄ λΈλμΉμ •λ³΄, νƒκ·Έμ •λ³΄λ¥Ό μ‘λ‹µν•λ‹¤.


<!-- μ΄μ— λ€ν• μ‘λ‹µμΌλ΅ μ„λ²„λ” μ•„λ ν¬λ§· `pkg-line`μ„ μ¤νΈλ¦ΌμΌλ΅ μ‘λ‹µν•λ‹¤. -->
<!-- μ„λ²„λ” νμΌ μ‹μ¤ν… λ‚΄ Bare Repositoryλ¥Ό νƒμƒ‰ν•΄ μ•„λ μ •λ³΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•λ‹¤. -->
- HEAD
- refs/heads/* (λΈλμΉμ •λ³΄)
- refs/tags/* (νƒκ·Έμ •λ³΄)

> μ΄ κ³Όμ •μ„ refκ΄‘κ³ (Discovery) λΌκ³  μΉ­ν•λ©°, ν΄λΌμ΄μ–ΈνΈκ°€ μ΄ν›„μ— Fetch μ”μ²­μ„ κµ¬μ„±ν•  μ μλ„λ΅ μ •λ³΄λ¥Ό μ κ³µν•λ‹¤.



#### 2. Upload
##### 2-1. Calculating
μ„ κ³Όμ •μ„ ν†µν•΄ μ„λ²„λ΅λ¶€ν„° `ref` μ •λ³΄λ¥Ό λ°›μ•„, ν΄λΌμ΄μ–ΈνΈμ—μ„ μ–΄λ–¤μ •λ³΄λ¥Ό μ „μ†΅ν•΄μ•Όν•λ”μ§€ ν΄λΌμ΄μ–ΈνΈμ—μ„ νλ‹¨μ„ μ§„ν–‰ν•λ‹¤. `Discovery` μ μ°¨μ—μ„λ°›μ€ serverμ `oid`μ™€ λ΅μ»¬μ `oid`λ¥Ό κ°€μ Έμ™€ μ–΄λμ •λ„μ λ³€κ²½μ‚¬ν•­μ„ μ—…λ΅λ“ν•΄μ•Όν•λ”μ§€ κ²°μ •ν•λ”λ° λ΅μ»¬μ `oid`κ°€ μ„λ²„μ `oid`λ³΄λ‹¤ ν›„μμ„μΈ κ²½μ°
λ΅μ»¬μ€ μ„λ²„μ μ΄λ ¥μ„ fetch ν•΄μ•Όν•λ―€λ΅ reject λλ‹¤.


##### 2-2. Createing Packfile
λ§μ•½, 

##### 2-3. Consistency Body
##### 2-4. Post


#### 2. Fetch 
ν΄λΌμ΄μ–ΈνΈλ” Discovery λ‹¨κ³„μ—μ„ λ°›μ€ refs μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅, μ„λ²„κ°€ κ°€μ§€κ³  μμ§€λ§ λ΅μ»¬μ—λ” μ—†λ” μ»¤λ°‹λ“¤μ„ μ”μ²­ν•λ‹¤.
``` bash 
POST /<repo>.git/git-upload-pack
```
- μ”μ²­μ—λ” `want`, `have`, `shallow` μµμ… λ“±μ΄ ν¬ν•¨λλ‹¤.





#### 3. Negotiation (λΉ„κµλ¥Ό ν†µν• λ™κΈ°ν™” κ²°μ •)
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°„μ refs μ •λ³΄λ¥Ό λΉ„κµ(handshake)
- λ΅μ»¬μ— μ—†λ” κ°μ²΄λ§ μ„ λ³„ν›„ μ”μ²­(ν¨μ¨μ  λ°μ΄ν„° μ „μ†΅)
- μ„λ²„λ” ν•„μ”ν• κ°μ²΄λ¥Ό κ³„μ‚°ν• ν›„ packfileμ„ μƒμ„±ν•μ—¬ μ‘λ‹µ


#### 4. Packfile μ „μ†΅ λ° μμ‹ 
μ„λ²„λ” side-band μ¤νΈλ¦Όμ„ ν†µν•΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ‹¤.

| μ±„λ„ | λ‚΄μ© |
| -------------- | --------------- |
| ch1 | pack λ°μ΄ν„° |
| ch2 | μ§„ν–‰λ¥  μ •λ³΄ |
| ch3 | μ¤λ¥ λ©”μ„Έμ§€ |

ν΄λΌμ΄μ–ΈνΈλ” μμ‹ ν• `.pack` νμΌμ„ λ΅μ»¬ κ°μ²΄ DBμ— λ°μν•κ³  μΈλ±μ¤λ¥Ό μ‘μ„±ν•λ‹¤.



#### 5. Merge or Rebase
Fetchκ°€ μ™„λ£λλ©΄, ν΄λΌμ΄μ–ΈνΈλ” λ΅μ»¬ λΈλμΉμ™€ λ³‘ν•©ν•κ±°λ‚ λ¦¬λ² μ΄μ¤λ¥Ό μν–‰ν•΄ μµμΆ…μ μΌλ΅ λ΅μ»¬ μƒνƒλ¥Ό κ°±μ‹ ν•λ‹¤.



### Conclusion
---
1. μ„λ²„λ” refs μ •λ³΄λ¥Ό μ κ³µ
2. ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό κΈ°λ°μΌλ΅ ν•„μ”ν• κ°μ²΄λ§ μ”μ²­ν•¨.
3. μ„λ²„λ” Pack νμΌμ„ μƒμ„± λ° μ‘λ‹µν•΄ ν¨μ¨μ  λ™κΈ°ν™”λ¥Ό μ§€μ›
4. μµμΆ…μ μΌλ΅ ν΄λΌμ΄μ–ΈνΈλ” Pack νμΌμ„ λ°›μ•„ Mergeλ‚ Rebaseλ¥Ό μν–‰ν•¨


<br>
<br>






















### Overview
---
ν΄λΌμ΄μ–ΈνΈμ—μ„ `git push` λ…λ Ήμ΄ μ‹¤ν–‰λλ©΄, μ„λ²„μ—μ„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ „μ†΅λ μ»¤λ°‹ λ° κ°μ²΄λ¥Ό μμ‹ ν•κ³  μ΄λ¥Ό **Bare Repositoryμ— λ°μ(μ“°κΈ° μ‘μ—…)** ν•λ‹¤.  
μ¦‰, μ„λ²„λ” **μ“°κΈ° μ¤‘μ‹¬μ λ™μ‘(write operation)** μ„ μν–‰ν•λ©°, μ‹¤μ  Mergeλ‚ Rebase μ—†μ΄ λ‹¨μν μ°Έμ΅°(refs)μ™€ κ°μ²΄λ¥Ό κ°±μ‹ ν•λ‹¤.

### Key Terms Explained
---
- `Pack`: Git κ°μ²΄λ¥Ό ν¨μ¨μ μΌλ΅ μ €μ¥ν•κΈ° μ„ν• μ••μ¶• νμΌ ν•μ‹μΌλ΅, `.pack` νμΌκ³Ό μΈλ±μ¤ μ—­ν• μ„ ν•λ” `.idx` νμΌλ΅ κµ¬μ„±λλ‹¤.  
- `Bare Repository`: `.git` ν΄λ”λ§ μ΅΄μ¬ν•λ©°, μ‘μ—… λ””λ ‰ν„°λ¦¬(working tree)κ°€ μ—†λ” μ €μ¥μ† ν•νƒλ΅, μ„λ²„μ—μ„ μ›κ²© μ €μ¥μ†λ΅ μ‚¬μ©λλ‹¤.  
- `git-upload-pack`: ν΄λΌμ΄μ–ΈνΈμ Pull(νΉμ€ Fetch) μ”μ²­μ„ μ²λ¦¬ν•λ” **μ½κΈ° μ „μ©** μ—”λ“ν¬μΈνΈ  
- `git-receive-pack`: ν΄λΌμ΄μ–ΈνΈμ Push μ”μ²­μ„ μ²λ¦¬ν•λ” **μ“°κΈ° μ „μ©** μ—”λ“ν¬μΈνΈ  

### Flow
---

Git ν΄λΌμ΄μ–ΈνΈκ°€ `git push`λ¥Ό μν–‰ν•λ©΄, μ„λ²„μ—μ„λ” `git-receive-pack` μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μ“°κΈ° μ”μ²­μ„ μ²λ¦¬ν•λ‹¤.  
μ΄ κ³Όμ •μ—μ„ μ„λ²„λ” μƒλ΅μ΄ μ»¤λ°‹κ³Ό κ°μ²΄λ¥Ό λ°›μ•„ Bare Repositoryμ— λ°μν•λ‹¤.

```mermaid
sequenceDiagram
    autonumber
    participant C as Client (git push)
    participant G as Git Server (JGit GitServlet)
    participant R as Bare Repo (.git) (FS)

    Note over C: git push = send commits + update refs<br/>μ„λ²„λ” μ“°κΈ°(λ°μ) μ¤‘μ‹¬μ μ‘μ—… μν–‰

    C->>G: GET /<repo>.git/info/refs?service=git-receive-pack
    G->>R: refs μ΅°ν + capability ν™•μΈ
    R-->>G: refs λ©λ΅
    G-->>C: refs + capabilities (Discovery λ‹¨κ³„)

    C->>G: POST /<repo>.git/git-receive-pack<br/>(update refs, packfile μ „μ†΅)
    C-->>G: packfile λ°μ΄ν„° μ „μ†΅ (.pack + .idx)
    G->>R: packfile μμ‹  λ° κ°μ²΄ μ €μ¥ (objects/pack)
    G->>R: refs μ—…λ°μ΄νΈ (e.g., refs/heads/main)

    Note over G,R: pre/post-receive hook λ“± μ‹¤ν–‰ κ°€λ¥

    G-->>C: μμ‹  κ²°κ³Ό μ‘λ‹µ(success or reject)
    Note over C: push μ™„λ£ λ©”μ‹μ§€ μ¶λ ¥

```





Flow Detail
1. Discovery

ν΄λΌμ΄μ–ΈνΈκ°€ git pushλ¥Ό μν–‰ν•λ©΄, λ‚΄λ¶€μ μΌλ΅ μ„λ²„μ
git-receive-pack μ—”λ“ν¬μΈνΈλ΅ refs μ •λ³΄λ¥Ό μ”μ²­ν•λ‹¤.

1-1. ν΄λΌμ΄μ–ΈνΈ μ”μ²­
GET /<repo>.git/info/refs?service=git-receive-pack


μ„λ²„μ μ°Έμ΅°(refs) μƒνƒλ¥Ό μ΅°νν•΄ μ–΄λ–¤ λΈλμΉλ¥Ό μ—…λ°μ΄νΈν•  μ μλ”μ§€ ν™•μΈν•λ‹¤.

1-2. μ„λ²„ μ‘λ‹µ

μ„λ²„λ” Bare Repository λ‚΄μ—μ„ μ•„λ μ •λ³΄λ¥Ό μ΅°νν•΄ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•λ‹¤.

HEAD

refs/heads/* (λΈλμΉ μ •λ³΄)

refs/tags/* (νƒκ·Έ μ •λ³΄)

μ΄ κ³Όμ •μ„ ref κ΄‘κ³ (Discovery) λΌ ν•λ©°,
ν΄λΌμ΄μ–ΈνΈλ” μ΄ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ μ–΄λ–¤ λΈλμΉμ— μ»¤λ°‹μ„ λ°μν• μ§€ κ²°μ •ν•λ‹¤.

2. Packfile μ „μ†΅ (Push Data)

ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ κ΄‘κ³ ν• refsλ¥Ό κΈ°μ¤€μΌλ΅,
λ³€κ²½ν•  λΈλμΉμ™€ μ»¤λ°‹μ„ μ§€μ •ν•κ³  μƒλ΅μ΄ κ°μ²΄λ¥Ό packfile ν•νƒλ΅ μ „μ†΅ν•λ‹¤.

POST /<repo>.git/git-receive-pack


μ”μ²­μ—λ” λ‹¤μ μ •λ³΄κ°€ ν¬ν•¨λλ‹¤:

ν•­λ©	μ„¤λ…
old-oid	κΈ°μ΅΄ μ»¤λ°‹ ν•΄μ‹
new-oid	μƒλ΅ ν‘Έμ‹ν•  μ»¤λ°‹ ν•΄μ‹
ref name	μ—…λ°μ΄νΈν•  λΈλμΉ μ΄λ¦„

μ‹¤μ  μ»¤λ°‹, νΈλ¦¬, λΈ”λ΅­ λ°μ΄ν„°λ” .pack νμΌμ— μ••μ¶•λμ–΄ μ „μ†΅λλ‹¤.

.idx νμΌμ€ packfile μΈλ±μ¤ μ—­ν• μ„ μν–‰ν•λ‹¤.

3. μμ‹  λ° κ²€μ¦ (Receiving Objects)

μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ „μ†΅ν• packfileμ„ μμ‹ ν• λ’¤ λ‹¤μ κ³Όμ •μ„ μν–‰ν•λ‹¤.

.pack λ° .idx νμΌμ„ objects/pack/ λ””λ ‰ν„°λ¦¬μ— μ €μ¥

λ¨λ“  κ°μ²΄μ λ¬΄κ²°μ„±(SHA-1 λλ” SHA-256) κ²€μ¦

μ—…λ°μ΄νΈν•λ ¤λ” refκ°€ fast-forward κ°€λ¥ν•μ§€ ν™•μΈ

fast-forwardκ°€ λ¶κ°€λ¥ν•  κ²½μ°,
receive.denyNonFastForwards μ„¤μ •μ— λ”°λΌ ν‘Έμ‹κ°€ κ±°λ¶€λ  μ μλ‹¤.

4. refs κ°±μ‹  λ° Hook μ‹¤ν–‰

κ²€μ¦μ΄ μ™„λ£λλ©΄ μ„λ²„λ” refs μ •λ³΄λ¥Ό κ°±μ‹ ν•λ‹¤.

μ:

refs/heads/main β†’ μƒλ΅μ΄ μ»¤λ°‹ ν•΄μ‹λ΅ λ³€κ²½


κ²½μ°μ— λ”°λΌ packed-refs νμΌμ— ν†µν•© μ €μ¥λ  μ μλ‹¤.

κ·Έ ν›„, μ„λ²„λ” λ‹¤μ ν›…(hook)μ„ μμ°¨μ μΌλ΅ μ‹¤ν–‰ν•λ‹¤:

Hook	μ—­ν• 
pre-receive	μμ‹  μ „ μ •μ±… κ²€μ¦ (μ: κ¶ν•, λΈλμΉ μ ν• λ“±)
update	κ° ref μ—…λ°μ΄νΈ μ‹ κ°λ³„ μ‹¤ν–‰
post-receive	μ„±κ³µ ν›„ ν›„μ²λ¦¬ (μ: CI/CD νΈλ¦¬κ±°, μ•λ¦Ό λ“±)

μ΄λ¥Ό ν†µν•΄ μ„λ²„λ” ν‘Έμ‹ ν›„ μλ™ λΉλ“, λ°°ν¬, μ•λ¦Ό μ‹μ¤ν…κ³Ό μ—°κ³„ν•  μ μλ‹¤.

5. κ²°κ³Ό μ‘λ‹µ (Result)

λ¨λ“  μ²λ¦¬κ°€ λλ‚λ©΄ μ„λ²„λ” κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈμ— λ°ν™ν•λ‹¤.

μƒνƒ	μ„¤λ…
ok	ν‘Έμ‹ μ„±κ³µ
ng	ν‘Έμ‹ κ±°λ¶€ (μ: fast-forward λ¶κ°€, κ¶ν• λ¬Έμ  λ“±)

ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό κΈ°λ°μΌλ΅ ν‘Έμ‹ κ²°κ³Όλ¥Ό μ¶λ ¥ν•λ‹¤.

Conclusion

μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ Push μ”μ²­μ„ μμ‹ ν•κ³ , packfileμ„ μ €μ¥ν•λ‹¤.

refs μ •λ³΄λ¥Ό κ°±μ‹ ν•κ³  ν•„μ” μ‹ hookμ„ μ‹¤ν–‰ν•λ‹¤.

ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„ μ‘λ‹µμ„ λ°›μ•„ ν‘Έμ‹ μ„±κ³µ μ—¬λ¶€λ¥Ό ν™•μΈν•λ‹¤.

μ „μ²΄ κ³Όμ •μ—μ„ μ„λ²„λ” μ“°κΈ° μ¤‘μ‹¬(write operation) μΌλ΅ λ™μ‘ν•λ©°,
ν΄λΌμ΄μ–ΈνΈμ λ³€κ²½μ‚¬ν•­μ΄ μ›κ²© μ €μ¥μ†μ— λ°μλλ‹¤.

π§  μ”μ•½

git push μ‹ μ„λ²„λ” git-receive-packμ„ ν†µν•΄ κ°μ²΄λ¥Ό μμ‹ ν•κ³  refsλ¥Ό μ—…λ°μ΄νΈν•λ‹¤.

Bare Repositoryλ” μ΄ κ³Όμ •μ„ ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ λ³€κ²½μ„ λ°μν•μ§€λ§, μ‘μ—… λ””λ ‰ν„°λ¦¬(working tree)λ” μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤.

push μ‹μ—λ” ν›…(hook) μ‹¤ν–‰μ΄ κ°€λ¥ν•λ©°, μ΄λ” CI/CD νμ΄ν”„λΌμΈμ μ£Όμ” νΈλ¦¬κ±° μ—­ν• μ„ ν•λ‹¤.

